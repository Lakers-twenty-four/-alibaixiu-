---
typora-root-url: ./
typora-copy-images-to: pic
---



# 项目简介



## 项目目标

我们利用6天时间完成阿里百秀项目（类似于自媒体文章发布系统）,学习成果是如何开发一个基本的动态网站。

所谓的动态网站，是指数据层面的动，并不是页面视觉层面的动，这个数据我们需要利用后台语言如php去mysql数据库中进行获取，再把数据展示前端页面中，这就是动态网站的开发。而静态网站的数据都是在页面中写死的。

**以上就是动态网站的本质**，现在企业中开发的网站基本都是动态网站。



此项目（阿里百秀）主要把之前所学的所有核心知识点（JavaScript、jQuery、Ajax、json、php、mysql）做一个综合运用，以及掌握前后台（B/S架构）如何进行数据的交互。

项目目标如下：

- 掌握基本的动态网站开发
- 掌握前后台数据（B/S架构）的交互
- （重点）**锻炼 JavaScript、JQuery、Ajax的综合使用能力**


## 项目效果预览



* 前台首页

  ![1530615602174](/pic/1530615602174.png)

* 后台

  ![1531036765656](/pic/1531036765656.png)


## 项目开发流程

见课件：项目开发流程图.xlsx

![1530611652905](/pic/1530611652905.png)



## 项目数据表结构

一共五张表：

- 分类表 category

- 文章表 posts

- 评论表 comments

- 后台用户表 users

- 轮播表swipe

  

表的说明：

**分类表 category**：

| 字段名    | 数据类型 | 备注                                         |
| :-------- | :------- | :------------------------------------------- |
| cat_id    | int      | 主键![1530614485040](/pic/1530614485040.png) |
| cat_name  | varchar  | 分类名称                                     |
| classname | varchar  | 类名（展示不同的分类图标）                   |

**文章表** posts：

| 字段名  | 数据类型 | 备注                                                   |
| :------ | :------- | :----------------------------------------------------- |
| post_id | int      | 主键![1530614485040](/pic/1530614485040.png)           |
| title   | varchar  | 文章标题                                               |
| feature | varchar  | 文章图片                                               |
| created | datetime | 创建时间                                               |
| content | text     | 文章内容                                               |
| views   | int      | 浏览数                                                 |
| likes   | int      | 点赞数                                                 |
| status  | varchar  | 状态（drafted-草稿、published-已发布、trashed-回收站） |
| user_id | int      | 关联后台用户表的user_id,记录谁发布的文章               |
| cat_id  | int      | 记录所属分类，关联分类表的cat_id字段                   |

**评论表 comments：**

| 字段名     | 数据类型 | 备注                                                         |
| :--------- | :------- | :----------------------------------------------------------- |
| comment_id | int      | 主键![1530614485040](/pic/1530614485040.png)                 |
| author     | varchar  | 评论的人                                                     |
| email      | varchar  | 邮箱                                                         |
| created    | datetime | 创建时间                                                     |
| content    | text     | 评论内容                                                     |
| status     | varchar  | 状态（held-待审核、approved-准许、rejected-拒绝、trashed-回收站） |
| post_id    | int      | 记录评论文章的id                                             |

**后台用户表 users：**

| 字段名   | 数据类型 | 备注                                                         |
| :------- | :------- | :----------------------------------------------------------- |
| user_id  | int      | 主键![1530614485040](/pic/1530614485040.png)                 |
| email    | varchar  | 邮箱                                                         |
| password | varchar  | 密码                                                         |
| nickname | varchar  | 昵称                                                         |
| photo    | varchar  | 头像（记录图片的url地址）                                    |
| bio      | int      | 介绍                                                         |
| status   | varchar  | 状态（unactivated-未激活、activated-激活、forbidden-禁止即封号） |

**轮播表 swipe**：

| 字段名   | 数据类型 | 备注                                         |
| :------- | :------- | :------------------------------------------- |
| swipe_id | int      | 主键![1530614485040](/pic/1530614485040.png) |
| img      | varchar  | 轮播图片                                     |
| text     | varchar  | 文本                                         |
| link     | varchar  | 链接地址                                     |




# 今日目标

- 掌握使用phpstudy搭建虚拟主机
- 会动态获取分类导航数据
- 会动态获取最新发布文章
- 能将前台公共页面进行抽离和包含
- 能够完成分类筛选的功能

# 项目部署

## 导入表数据

1. 创建数据库

```mysql
 create database 数据库名   # 推荐使用mysql可视化工具navicat来创建
```

2. 运行sql语句

   在navicat中选中要导入的数据库，把课件中的bx.sql进行导入即可。

   具体步骤：

   >  选中数据库-->右键运行sql文件-->找到课件中的bx.sql文件-->点击开始。 

   若成功导入会提示successful。

   

   


## 配置虚拟主机访问

例如：配置域名为bx.com,访问此域名的时候直接访问到G:\bx.com虚拟目录。

> 注：域名和虚拟目录可以按照个人喜好自定义，上面只是给个参考

步骤如下：

步骤1：双击打开phpstudy .exe，找到其他选项菜单，点击站点域名管理。

![1530618903181](/pic/1530618903181.png)

步骤2：设置域名和绑定的虚拟目录，先点击新增，后保存设置并生成配置文件

![1530619104157](/pic/1530619104157.png)

最后记得重启phpstudy，让配置生效。

步骤3：修改hosts文件，设置ip到域名的映射

![1530619285472](/pic/1530619285472.png)

内容为：

```
127.0.0.1       bx.com
```

步骤4：把课件中的所有项目文件复制一份到上面配置的虚拟目录中，输入域名进行访问

![1530619742843](/pic/1530619742843.png)

访问后台，域名后面加个admin:  http://bx.com/admin

![1530621312267](/pic/1530621312267.png)

## 项目目录结构

![1531036291787](/pic/1531036291787.png)



## 修改静态资源文件路径

- 在绑定的虚拟目录（即网站根目录）中，定义一个静态资源目录static,用于存放网站的所有的静态资源（img、css、image、插件、上传的文件等），方便后期维护和管理。

- 在sublime编辑器中使用快捷键`ctrl+shift+f`，设置一个需要替换的文件目录，把此目录中所有的文件的静态路径替换成正确的静态资源路径。

  如下：

  ![1530621013255](/pic/1530621013255.png)



## 修改静态文件后缀为php

> 疑问？为什么要把静态文件后缀.html修改为.php呢？
>
>  这是因为静态文件中的数据都是写死的，不是从数据库动态获取过来的，想在静态页面.html中写php代码操作数据库获取数据，则是行不通的，所以需要改后缀为.php才可行。



如果静态文件太多，一个个改的话太费时间，这里有一个快捷方法，利用ren命令重命名文件

使用cmd命令行工具，进入到**自己的项目目录**，把所有后缀为`*.html`的文件重命名为 `*.php`

`````
[项目目录] > ren *.html *.php
`````

> 如何让cmd直接定位到当前目录呢？
>
> 先进入到指定的目录，快捷键：ctrl+shift+鼠标右键，会多出一个**在此处打开命令行窗口**的选项,点击进入即可。

## 抽离前台公共页面

由于前台很多页面，两个侧边栏都是相同的内容，所以我们要把他们抽离出来，使用的时候用include_once引入进来即可，这样可提高代码的复用性。

![1530629948844](/pic/1530629948844.png)

把上面公共侧边栏代码抽离出来，写在如下文件中：

```
aside.php
```

进行引入：

```
include_once 'aside.php';
```

#动态生成分类导航数据

如下效果：

![1530630391982](/pic/1530630391982.png)

> 上面的分类数据从哪里来？ 
>
> 由于我们做的是动态网站，数据不可以在页面上写死，需要从数据库动态获取，在展示到前端页面上。



## 思考，如何取出分类的数据呢？

步骤：

- 连接数据库
- 编写sql语句
- 执行sql语句获取数据
- 根据数据动态生成页面结构。

## 具体实现

1. 连接数据库

$link = mysqli_connect('主机','用户名','密码','数据库名')

```mysql
$link = mysqli_connect('127.0.0.1','root','root','bxdev');	
mysqli_query($link,"set names utf8"); #设置编码格式为utf8格式
```
2. 编写sql语句

```mysql
select * from category 
```

结果：

![1530631855923](/pic/1530631855923.png)

如果要过滤掉未分类的数据，sql加条件`where  cat_id !=1 `即可

```mysql
select * from category where cat_id !=1
```
结果：

![1530631991969](/pic/1530631991969.png)

3. 执行sql语句获取数据

```php
$res = mysqli_query($link,$sql);
$catsData = [];
//循环资源结果集$res,把数据用变量$row接收，在存入到$catsData数组中
while($row = mysqli_fetch_assoc($res)){
		$catsData[] = $row;
};
```

4. 根据数据动态生成页面结构。

```php+HTML
<?php foreach($catsData as $v):  ?>
	<!-- 注：这里是demo,需根据页面结构，遍历指定的html结构 -->
	<div><?php echo $v['cat_name']?></div>   
<?php endforeach;?>
```


# 最新发布文章

如下效果：

![1530633516806](/pic/1530633516806.png)

## 分析获取文章数据

可见，每篇文章都会包含很多数据。给他们编号如下：

![1530634115625](/pic/1530634115625.png)



其中编号为：2、4、5、6、7、9的数据可从`文章表-posts`中可以获取到。



那么1、3、8、10的数据如何获取？

编号为`1、10`的数据应是一样的，属于某个分类下，文章分类的数据应从`分类表-category`中获取,可见文章表需要关联分类表进行联表查询。

编号为`3`数据是当前文章的发布者，数据应从`用户表-users`中获取,可见文章表需要关联用户表进行联表查询。

编号为`8`数据是获取文章的所有评论数，文章评论数是存在于`评论表-comments`中。可见文章表需要关联评论表进行联表查询



可知获取文章的所有有关数据需要操作以下四张表：

- 文章表-posts
- 分类表-category
- 用户表-users
- 评论表-comments



## 获取文章数据的sql语句编写

步骤：

- 连接数据库
- 编写sql语句
- 执行sql语句获取数据
- 最后根据数据动态生成页面结构。



重点是sql上面如何编写：下面提供两种方式

方式一：

```mysql
SELECT t1.*, t2.cat_name,t3.nickname,count('t4.*')  commentsCount
FROM posts t1
LEFT JOIN category t2 ON t1.cat_id = t2.cat_id
LEFT JOIN users t3 ON t1.user_id = t3.user_id
LEFT JOIN comments t4 on t1.post_id = t4.post_id group by t1.post_id
```

方式二：

```mysql
SELECT t1.*, t2.cat_name,t3.nickname,
(select count(post_id) from comments where post_id = t1.post_id) as commentsSum
FROM posts t1
LEFT JOIN category t2 ON t1.cat_id = t2.cat_id
LEFT JOIN users t3 ON t1.user_id = t3.user_id
```

>  注：方式二与方式一不同的地方是把查询评论的总数单独写成一条select查询语句，再把查询结果作为第一个select语句的某一列。



两种方式获取到的数据都是一样的：

![1530636109844](/pic/1530636109844.png)





# 首页分类筛选

如下效果：

![1530637059682](/pic/1530637059682.png)

## 思路分析-代码实现

点击左侧不同的分类，右侧应展示对应分类下面的文章。

步骤：

1. 构造分类的链接地址，带上参数cat_id,根据cat_id方可获取指定分类下的文章。
2. 接收cat_id参数
3. 连接数据库、编写sql语句、查询数据、动态生成页面结构

代码实现：



# 封装公用的函数

 可发现之前的功能，操作数据库的步骤都是以下三步：

- 连接数据库
- 编写sql语句
- sql语句查询组装数据

所以，为了提高代码的复用性和让代码看起来更加简洁，我们可以把上面几步封装成一个公用的函数，每次使用的使用调用它们即可。

代码如下：

​	